# Regras do Projeto EasyDrive

## ğŸ“š DocumentaÃ§Ã£o Principal (Fonte Ãšnica da Verdade)

**SEMPRE consulte a documentaÃ§Ã£o completa antes de qualquer alteraÃ§Ã£o:**

1. **[`./ai/AI-GUIDE.md`](./ai/AI-GUIDE.md)** - GUIA MESTRE com instruÃ§Ãµes completas
2. **[`./ai/00-project-overview.md`](./ai/00-project-overview.md)** - Contexto detalhado do projeto
3. **[`./ai/supabase-declarative-database-schema.md`](./ai/supabase-declarative-database-schema.md)** - Workflow OBRIGATÃ“RIO para banco de dados
4. **[`./ai/supabase-create-migration.md`](./ai/supabase-create-migration.md)** - Diretrizes de migraÃ§Ã£o

---

## ğŸš¨ Regras CrÃ­ticas NÃƒO-NEGOCIÃVEIS

### 1. DTOs SÃ£o OBRIGATÃ“RIOS

```typescript
// âŒ NUNCA exponha entidades do banco diretamente
export function getUser() {
  return supabase.from("users").select("*");
}

// âœ… SEMPRE use DTOs (Public/Private)
export function getUser(): UserPublicDTO {
  const user = await supabase.from("users").select("*");
  return toUserPublicDTO(user);
}
```

**Regra:** NUNCA exponha entidades do banco de dados diretamente. SEMPRE use DTOs com variantes Public/Private.

### 2. ValidaÃ§Ã£o com Zod

```typescript
// âœ… SEMPRE valide TODA entrada com Zod
import { z } from "zod";

const loginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
});

const result = loginSchema.safeParse(data);
```

**Regra:** TODA entrada de dados DEVE ser validada com schemas Zod.

### 3. Workflow Supabase (DECLARATIVO)

```
supabase/
â”œâ”€â”€ schemas/          â† Arquivos SQL declarativos AQUI
â”‚   â”œâ”€â”€ tables/
â”‚   â”œâ”€â”€ functions/
â”‚   â””â”€â”€ policies/
â””â”€â”€ migrations/       â† Gerado automaticamente via CLI
```

**Regras:**

- âŒ NUNCA crie migrations manualmente em `supabase/migrations/`
- âœ… SEMPRE crie schemas em `supabase/schemas/`
- âœ… SEMPRE use `supabase db diff` para gerar migrations
- âœ… CONSULTE [`./ai/supabase-declarative-database-schema.md`](./ai/supabase-declarative-database-schema.md) ANTES de qualquer alteraÃ§Ã£o no DB

### 4. SeguranÃ§a

**NUNCA exponha:**

- Senhas ou hashes
- CPF completo (use `XXX.XXX.XXX-XX`)
- Tokens de autenticaÃ§Ã£o
- Telefones completos (use `(XX) XXXXX-XXXX`)
- Dados financeiros sem criptografia

### 5. Componentes Server/Client

```typescript
// Server Component (padrÃ£o)
export default async function Page() {
  const data = await fetchData()
  return <div>{data}</div>
}

// Client Component (interativo)
'use client'
export default function InteractiveComponent() {
  const [state, setState] = useState()
  return <button onClick={...}>Click</button>
}
```

**Regra:** SeparaÃ§Ã£o clara entre Server e Client Components. Use `'use client'` SOMENTE quando necessÃ¡rio.

### 6. Type Safety

```typescript
// âŒ NUNCA use any
function process(data: any) {}

// âœ… SEMPRE use tipos especÃ­ficos
function process(data: User) {}
```

**Regra:** NUNCA use `any`. Mantenha type safety end-to-end.

---

## ğŸ¯ Guia RÃ¡pido por Tarefa

### Criando uma Nova Feature

1. Consulte [`./ai/AI-GUIDE.md`](./ai/AI-GUIDE.md) seÃ§Ã£o "Arquitetura"
2. Crie estrutura em `features/[feature-name]/`:

```
features/[feature-name]/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ server/
â”‚   â””â”€â”€ shared/
â”œâ”€â”€ queries/
â”‚   â”œâ”€â”€ queries.ts
â”‚   â””â”€â”€ mutations.ts
â”œâ”€â”€ api/
â”œâ”€â”€ dtos/
â”œâ”€â”€ types/
â”œâ”€â”€ validations/
â””â”€â”€ services/
```

### AlteraÃ§Ãµes no Banco de Dados

**WORKFLOW OBRIGATÃ“RIO:**

1. Leia [`./ai/supabase-declarative-database-schema.md`](./ai/supabase-declarative-database-schema.md)
2. Edite/crie schema em `supabase/schemas/`
3. Execute `supabase db diff --use-migra -f [nome-descritivo]`
4. Revise a migration gerada
5. Execute `supabase db reset` para testar

### Criando Componentes

1. **Server Components**: `features/[feature]/components/server/`
2. **Client Components**: `features/[feature]/components/client/` (adicione `'use client'`)
3. **Shared**: `features/[feature]/components/shared/`
4. Use RetroUI da pasta [`components/retroui/`](./components/retroui/)

### API Routes

1. Crie em `features/[feature]/api/[route]/route.ts`
2. Valide input com Zod
3. Use DTOs para output
4. Exemplo:

```typescript
// features/users/api/profile/route.ts
import { z } from "zod";
import { NextResponse } from "next/server";

const updateProfileSchema = z.object({
  name: z.string(),
  phone: z.string(),
});

export async function POST(request: Request) {
  const body = await request.json();
  const result = updateProfileSchema.safeParse(body);

  if (!result.success) {
    return NextResponse.json({ error: result.error }, { status: 400 });
  }

  // Processar...
  return NextResponse.json({ data: userPublicDTO });
}
```

### Queries e Mutations (React Query)

1. Queries em `features/[feature]/queries/queries.ts`
2. Mutations em `features/[feature]/queries/mutations.ts`
3. Sempre retorne DTOs

---

## ğŸ—ï¸ Arquitetura do Projeto

### PapÃ©is de UsuÃ¡rio

- **Aluno**: Estudante de direÃ§Ã£o
- **Instrutor**: Instrutor certificado
- **Admin**: Administrador da plataforma

### Tech Stack

- **Framework**: Next.js 14+ (App Router)
- **Linguagem**: TypeScript
- **Estilo**: Tailwind CSS v4 + RetroUI
- **Banco de Dados**: Supabase (PostgreSQL)
- **ValidaÃ§Ã£o**: Zod
- **Data Fetching**: React Query
- **AutenticaÃ§Ã£o**: Supabase Auth

### Path Aliases

```typescript
"@/*"           â†’ "./"
"@features/*"   â†’ "./features/*"
"@components/*" â†’ "./components/*"
"@lib/*"        â†’ "./lib/*"
```

### ConvenÃ§Ãµes de Nomenclatura

- **Pages**: `page.tsx`
- **Layouts**: `layout.tsx`
- **API Routes**: `route.ts`
- **Components**: `PascalCase.tsx`
- **Services**: `*.service.ts`
- **DTOs**: `*.dto.ts`
- **Schemas**: `*.schema.ts`
- **Types**: `*.types.ts`

---

## ğŸ¨ RetroUI Design System

### Componentes DisponÃ­veis

Consulte [`./components/retroui/`](./components/retroui/) para componentes:

**BÃ¡sicos:**

- Button, Input, Label, Text, Card
- Badge, Avatar, Alert

**FormulÃ¡rios:**

- Checkbox, Radio, Switch, Select, Slider

**NavegaÃ§Ã£o:**

- Menu, Breadcrumb, Command

**Feedback:**

- Dialog, Popover, Tooltip, Loader, Progress

**Data:**

- Table, Calendar, Accordion

**Charts:**

- AreaChart, BarChart, LineChart, PieChart

### Uso

```typescript
import { Button } from '@/components/retroui/Button'
import { Card } from '@/components/retroui/Card'

<Button variant="primary">Salvar</Button>
<Card>ConteÃºdo</Card>
```

---

## ğŸ“ Estrutura de Pastas

```
easy-drive/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ (marketing)/       # Grupo de rotas pÃºblicas
â”‚   â”œâ”€â”€ auth/              # AutenticaÃ§Ã£o
â”‚   â””â”€â”€ protected/         # Rotas protegidas
â”œâ”€â”€ features/              # Features modulares
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ marketing/
â”‚   â””â”€â”€ [feature-name]/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ retroui/          # Design System
â”‚   â””â”€â”€ supabase/         # Componentes Supabase
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/         # Clientes Supabase
â”‚   â””â”€â”€ utils.ts
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ schemas/          # âš ï¸ SCHEMAS DECLARATIVOS AQUI
â”‚   â””â”€â”€ migrations/       # Gerado automaticamente
â””â”€â”€ ai/                   # ğŸ“š DOCUMENTAÃ‡ÃƒO PRINCIPAL
```

---

## ğŸ”— Links Importantes

- **DocumentaÃ§Ã£o Completa**: [`./ai/AI-GUIDE.md`](./ai/AI-GUIDE.md)
- **VisÃ£o Geral**: [`./ai/00-project-overview.md`](./ai/00-project-overview.md)
- **Workflow Supabase**: [`./ai/supabase-declarative-database-schema.md`](./ai/supabase-declarative-database-schema.md)
- **Migrations**: [`./ai/supabase-create-migration.md`](./ai/supabase-create-migration.md)

---

## âš ï¸ Antes de Qualquer AlteraÃ§Ã£o

1. âœ… Consulte a documentaÃ§Ã£o em [`./ai/`](./ai/)
2. âœ… Verifique se estÃ¡ seguindo as regras nÃ£o-negociÃ¡veis
3. âœ… Use DTOs para expor dados
4. âœ… Valide com Zod
5. âœ… Para DB: use workflow declarativo do Supabase
6. âœ… Mantenha type safety (sem `any`)
7. âœ… Separe Server/Client components corretamente

---

**Lembre-se:** A documentaÃ§Ã£o em [`./ai/`](./ai/) Ã© a FONTE ÃšNICA DA VERDADE. Em caso de dÃºvida, SEMPRE consulte primeiro.
